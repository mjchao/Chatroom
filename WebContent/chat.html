<!DOCTYPE html>
<html>
	<head>
		<title>Chatroom</title>
		
		<link href="css/styles.css" type="text/css" rel="stylesheet" />
		
		<style type="text/css">
			#pnlMain {
				display: table;
				float: left;
				overflow: hidden;
			}
		
			#pnlMain>div {
				float: left;
				border: 1px solid black;
				display: table-cell;
				padding: 1em;
				height: 24em;
			}
			
			#pnlChatHistory {
				max-height: 24em;
			}
			
			#pnlUserList {
				max-height: 24em;
				overflow: scroll;
			}
			
		</style>
	</head>
	<body>
		<div id="pnlMain">
			<div id="pnlCenter">
				<div id="pnlUserData">
					<label id="lblDisplayName"> Hello </label>
					<input type="button" name="cmdLogout" value="Logout" onclick="cmdLogout_Click()"/>
				</div>
				<div id="pnlChatHistory">
					<textarea name="txtChatHistory" rows="20" cols="50" readonly="readonly"></textarea>
				</div>
				<div id="pnlSend">
					<input type="text" id="txtMessage" name="txtMessage" size="50" placeholder="Enter message" onkeypress="txtMessage_KeyPress( event )"/>
					<input type="button" name="cmdSend" value="Send" onclick="cmdSend_Click();"/>	
				</div>
			</div>
			<div id="pnlUserList">
				<label id="lblUserList">Active Users</label><br />
				<input type="button" name="cmdUser1" value="User1"/><br />
				<input type="button" name="cmdUser2" value="User2"/><br />
			</div>
		</div>
		<input type="button" name="cmdTest" value="Test" onclick="test();" />
		
		
		<script type="text/javascript">
			window.onload = showDisplayName();
			
			var VK_ENTER = 13
			
			function sendMessage( message ) {
				
				//do not send empty messages to the chat server
				if ( message != "") {
					alert( "Sending message to server: " + message );
				}
			}
			
			function txtMessage_KeyPress( e ) {
				if ( !e ) {
					e = window.event;
				}
				keycode = e.which || e.keycode;
				if ( keycode === VK_ENTER ) {
					cmdSend_Click();
				}
			}
		
			function cmdSend_Click() {
				var message = document.getElementById( "txtMessage" ).value;
				sendMessage( message );
				
				//clear the message text box
				txtMessage.value = ""
			}
			
			function cmdLogout_Click() {
				window.location.href = "login.html"
			}
			
			function showDisplayName() {
				var formInput = window.location.search;
				
				//replace all "+"s with " "s
				while( formInput.indexOf( "+" ) != -1 ) {
					formInput = formInput.replace( "+" , " " );
				}
				
				var displayName = formInput.substring( formInput.indexOf( "displayName=" )+12 , formInput.length );
				var lblDisplayName = document.getElementById( "lblDisplayName" );
				lblDisplayName.innerHTML = "Logged in as <span class=\"displayNameText\">" + displayName + "</span>";
			}
			
			function privateMessage( username ) {
				alert( "Private messaging " + username );
			}
			
			function addUserToUserList( username ) {
				var newUser = document.createElement( "input" );
				newUser.type = "button";
				newUser.value = username;
				newUser.name = username;
				newUser.onclick = function() {
					privateMessage( username );
				}
				
				var userList = document.getElementById( "pnlUserList" );
				userList.appendChild( newUser );
				userList.appendChild( document.createElement( "br" ) );
				
			}
			
			var nextId=2;
			function test() {
				addUserToUserList( "User " + nextId );
			}
		</script>
	</body>
</html>